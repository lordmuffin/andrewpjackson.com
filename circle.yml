machine:
  environment:
    CIRCLE_BUILD_DIR: $HOME/$CIRCLE_PROJECT_REPONAME
    PATH: '$PATH:$CIRCLE_BUILD_DIR/bin:/home/ubuntu/go/bin:$PATH'
    GOPATH: /home/ubuntu/go
    ROOTPATH: /home/ubuntu/go/src/andrewpjackson.com/bin

  post:
    - mkdir -p $CIRCLE_BUILD_DIR/bin
checkout:
  post:
    - mkdir -p $ROOTPATH
    - cp -r "/home/ubuntu/$(basename $ROOTPATH)" $(dirname $ROOTPATH)
dependencies:
  pre:
    - go get github.com/kardianos/govendor
    # - bash ./ci-install-hugo.sh
    - go get github.com/kardianos/govendor
    - govendor get github.com/gohugoio/hugo
    - go install github.com/gohugoio/hugo
    # - go get -v github.com/JacksonConsulting/s3up
    - git clone https://github.com/halogenica/beautifulhugo.git themes/beautifulhugo
    - git clone https://github.com/tomanistor/osprey.git themes/osprey
  override:
    - cd $ROOTPATH && govendor sync

  cache_directories:
    - bin
test:
  override:
    - GIT_COMMIT_SHA=`git rev-parse --verify HEAD` GIT_COMMIT_SHA_SHORT=`git rev-parse --short HEAD`
    - hugo -v -t osprey
deployment:
  s3up:
    branch: master
    commands:
      - aws s3 sync public/ s3://$BUCKET --delete
